{"version":3,"sources":["../../src/components/flow-detail/index.jsx"],"names":["FlowDetail","props","onTabChange","renderTabs","renderApprove","renderInfo","renderHeader","TabsComponent","onOkSuccess","onRejectSuccess","onTransferSuccess","data","id","request","tabs","tabProps","rest","fullScreen","setFullScreen","visible","setVisible","detailData","setDetailData","remark","setRemark","tasks","setTasks","loading","setLoading","el","useModal","modal","contextHolder","_fetchData","useForm","form","_detailApi","getDetail","procInstId","url","postApprove","_tabs","name","key","render","tabItem","current","method","res","d","_task","runTimeTasks","filter","item","approveFlag","length","setFieldsValue","taskId","console","log","_onTabChange","_onFullScreen","requestFullscreen","_onExitFullScreen","document","exitFullscreen","_onTransfer","_modalConfig","title","content","okText","cancelText","_onOk","validateFields","values","confirm","onOk","Promise","resolve","reject","_postApprove","_onReject","status","msg","success","resetFields","_onTransferOk","approveRemark","_onTransferCancel","_onRemarkChange","changedValues","allValues","_onModelFormChange","reason","_renderApprove","hideNodeSelect","labelCol","span","wrapperCol","width","display","required","message","map","i","nodeName","userNames","_renderHeader","_renderTabs","Tabs","FlowTabs"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef, useCallback } from \"react\";\nimport {\n  FlowViewer,\n  FlowRecord,\n  FlowTabs,\n  TabPane,\n  FlowActionButtons,\n  FlowTransferModal,\n  FlowFullScreen,\n} from \"../index\";\nimport \"../flow-viewer/style\";\nimport \"../flow-record/style\";\nimport \"../flow-action-buttons/style\";\nimport {\n  Button,\n  Row,\n  Col,\n  Input,\n  Modal,\n  Select,\n  Form,\n  message,\n  Spin,\n} from \"antd\";\nimport api from \"../api\";\nimport \"./style/index\";\n\nimport { FullscreenOutlined, FullscreenExitOutlined } from \"@ant-design/icons\";\n\nexport default function FlowDetail(props) {\n  const {\n    onTabChange,\n    renderTabs,\n    renderApprove,\n    renderInfo,\n    renderHeader,\n    TabsComponent,\n    onOkSuccess,\n    onRejectSuccess,\n    onTransferSuccess,\n    data,\n    id,\n    request,\n    tabs = [],\n    tabProps = {},\n    ...rest\n  } = props;\n\n  const [fullScreen, setFullScreen] = useState(false);\n  const [visible, setVisible] = useState(false);\n  const [detailData, setDetailData] = useState({});\n  const [remark, setRemark] = useState(\"\");\n  const [tasks, setTasks] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const el = useRef();\n  const [modal, contextHolder] = Modal.useModal();\n\n  useEffect(() => {\n    if (id && !data) {\n      _fetchData(id);\n    }\n    return () => {};\n  }, [id]);\n\n  useEffect(() => {\n    if (data) {\n      setDetailData(data);\n    }\n    return () => {};\n  }, [data]);\n\n  const [form] = Form.useForm();\n\n  const _detailApi = useRef({\n    getDetail: (procInstId) => ({\n      url: `/caas/osoBpmProcInst/getFlowDetailByProcInstId/${procInstId}`,\n    }),\n\n    postApprove: () => ({\n      url: `/caas/osoBpmTask/approve`,\n    }),\n  });\n\n  const _tabs = useRef([\n    {\n      name: \"审批信息\",\n      key: \"approve_form\",\n      render: renderInfo,\n    },\n    {\n      name: \"审批日志\",\n      key: \"approve_records\",\n      render: (tabItem, data) => <FlowRecord data={data} />,\n    },\n    {\n      name: \"流程图\",\n      key: \"task_viewer\",\n      render: (tabItem, data) => <FlowViewer data={data} />,\n    },\n    ...tabs,\n  ]);\n\n  const _fetchData = async (id) => {\n    if (request) {\n      try {\n        setLoading(true);\n        const { url } = _detailApi.current.getDetail(id);\n        let res = await request({ method: \"GET\", url });\n        let d = res?.data?.data;\n        setDetailData(d);\n        // console.log(d?.runTimeTasks?.filter((item) => item.approveFlag))\n        let _task = d?.runTimeTasks?.filter((item) => item.approveFlag) || []\n        if (_task.length === 1) {\n          form.setFieldsValue({ taskId: _task[0].taskId });\n        }\n        setTasks(_task);\n      } catch (e) {\n        console.log(e);\n      } finally {\n        setLoading(false);\n      }\n    }\n  };\n\n  const _onTabChange = (key) => {\n    onTabChange && onTabChange(key);\n  };\n\n  const _onFullScreen = () => {\n    el.current.requestFullscreen();\n  };\n\n  const _onExitFullScreen = () => {\n    document.exitFullscreen();\n  };\n\n  const _onTransfer = () => {\n    setVisible(true);\n  };\n\n  const _modalConfig = () => ({\n    title: \"确认!\",\n    content: \"同意该流程?\",\n    okText: \"确定\",\n    cancelText: \"取消\",\n  });\n\n  const _onOk = async () => {\n    // console.log(\"onOk\");\n    try {\n      const values = await form.validateFields();\n      console.log(values)\n      modal.confirm({\n        ..._modalConfig(),\n        content: \"同意该流程?\",\n        onOk: () => {\n          return new Promise(async (resolve, reject) => {\n            try {\n              await _postApprove(\"AGREE\", values);\n              if (typeof onOkSuccess === \"function\") onOkSuccess();\n              resolve()\n            } catch (e) {\n              reject(e);\n            }\n          });\n        },\n      });\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  const _onReject = async () => {\n    try {\n      const values = await form.validateFields();\n      modal.confirm({\n        ..._modalConfig(),\n        content: \"驳回该流程?\",\n        onOk: () => {\n          return new Promise(async (resolve, reject) => {\n            try {\n              await _postApprove(\"REJECT\", values);\n              if (typeof onRejectSuccess === \"function\") onRejectSuccess();\n              resolve();\n            } catch (e) {\n              reject(e);\n            }\n          });\n        },\n      });\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  const _postApprove = async (status, values) => {\n    try {\n      const { url } = _detailApi.current.postApprove();\n      let res = await request({\n        method: \"POST\",\n        url,\n        data: {\n          status,\n          ...values,\n        },\n      });\n      let msg = res?.data?.data;``\n      message.success(msg);\n      form.resetFields();\n      setRemark(\"\");\n      _fetchData(id);\n      return Promise.resolve()\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n\n  const _onTransferOk = () => {\n    _fetchData(id);\n    setVisible(false);\n    form.setFieldsValue({ approveRemark: \"\" });\n    if (typeof onTransferSuccess === \"function\") onTransferSuccess();\n  };\n\n  const _onTransferCancel = () => {\n    setVisible(false);\n  };\n\n  const _onRemarkChange = (changedValues, allValues) => {\n    setRemark(changedValues.approveRemark);\n  };\n\n  const _onModelFormChange = (changedValues) => {\n    form.setFieldsValue({ approveRemark: changedValues.reason });\n  };\n\n  const _renderApprove = () => {\n    if (typeof renderApprove === \"function\") return renderApprove();\n    const hideNodeSelect =  tasks.length <= 1;\n    return (\n      <div className=\"flow-approve-detault\">\n        <Form\n          {...{\n            labelCol: { span: 2 },\n            wrapperCol: { span: 22 },\n          }}\n          form={form}\n          style={{ width: \"100%\" }}\n          name=\"flow-detail-default\"\n          onValuesChange={_onRemarkChange}\n        >\n          <Form.Item\n            style={{display: hideNodeSelect ? 'none' : ''}}\n            label=\"流程节点\"\n            name=\"taskId\"\n            rules={[{ required: !hideNodeSelect, message: \"请选择流程节点\" }]}\n          >\n            <Select\n              // mode=\"multiple\"\n              disabled={hideNodeSelect}\n              placeholder=\"选择流程节点\"\n              // onChange={onChange}\n            >\n              {tasks?.map((d, i) => (\n                <Select.Option key={i} value={d.taskId}>\n                  {`${d.nodeName} - ${d.userNames}`}\n                </Select.Option>\n              ))}\n            </Select>\n          </Form.Item>\n          <Form.Item\n            label=\"备注说明：\"\n            name=\"approveRemark\"\n            rules={[{ required: true, message: \"请输入备注说明!\" }]}\n          >\n            <Input.TextArea placeholder=\"请输入备注说明\" />\n          </Form.Item>\n        </Form>\n      </div>\n    );\n  };\n\n  const _renderHeader = () => {\n    if (typeof renderHeader === \"function\") return renderHeader(props);\n    return (\n      <div className=\"flow-detail-header\">\n        <div className=\"flow-detail-top\">\n          <div className=\"flow-detail-title\">\n            {detailData && detailData.title}\n          </div>\n          <FlowFullScreen el={el} />\n        </div>\n        <div className=\"flow-approve\">{_renderApprove()}</div>\n\n        <FlowActionButtons\n          data={detailData}\n          onTransfer={_onTransfer}\n          onAgree={_onOk}\n          onReject={_onReject}\n          canApprove={tasks.length}\n          {...rest}\n        />\n      </div>\n    );\n  };\n\n  const _renderTabs = () => {\n    if (typeof renderTabs === \"function\") return renderTabs(props);\n    const Tabs = TabsComponent || FlowTabs;\n    return (\n      <Tabs\n        defaultActiveKey={_tabs?.current[0]?.key}\n        onChange={_onTabChange}\n        {...tabProps}\n      >\n        {_tabs.current\n          ?.filter((d) => d.render)\n          ?.map((d) => (\n            <TabPane tab={d.name} key={d.key}>\n              {d.render && d.render(d, detailData)}\n            </TabPane>\n          ))}\n      </Tabs>\n    );\n  };\n\n  return (\n    <div className=\"flow-detail\" ref={el}>\n      <Spin spinning={loading}>\n        {detailData.approveFlag === false ? null : _renderHeader()}\n        {/* {_renderHeader()} */}\n        {_renderTabs()}\n        <FlowTransferModal\n          visible={visible}\n          remark={remark}\n          setRemark={setRemark}\n          runTimeTasks={detailData?.runTimeTasks || []}\n          onOk={_onTransferOk}\n          request={request}\n          onCancel={_onTransferCancel}\n          onModelFormChange={_onModelFormChange}\n        />\n        {contextHolder}\n      </Spin>\n    </div>\n  );\n}\n"],"file":"index.js"}