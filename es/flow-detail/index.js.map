{"version":3,"sources":["../../src/components/flow-detail/index.jsx"],"names":["React","useEffect","useState","useRef","useCallback","FlowViewer","FlowRecord","FlowTabs","TabPane","FlowActionButtons","FlowTransferModal","FlowFullScreen","api","FullscreenOutlined","FullscreenExitOutlined","FlowDetail","props","onTabChange","renderTabs","renderApprove","renderInfo","renderHeader","TabsComponent","onOkSuccess","onRejectSuccess","onTransferSuccess","data","id","request","tabs","tabProps","rest","fullScreen","setFullScreen","visible","setVisible","detailData","setDetailData","remark","setRemark","tasks","setTasks","loading","setLoading","el","useModal","modal","contextHolder","_fetchData","useForm","form","_detailApi","getDetail","procInstId","url","postApprove","_tabs","name","key","render","tabItem","current","method","res","d","runTimeTasks","filter","item","approveFlag","console","log","_onTabChange","_onFullScreen","requestFullscreen","_onExitFullScreen","document","exitFullscreen","_onTransfer","_modalConfig","title","content","okText","cancelText","_onOk","validateFields","values","confirm","onOk","Promise","resolve","reject","_postApprove","_onReject","status","msg","success","resetFields","_onTransferOk","setFieldsValue","approveRemark","_onTransferCancel","_onRemarkChange","changedValues","allValues","_onModelFormChange","reason","_renderApprove","labelCol","span","wrapperCol","width","required","message","map","i","taskId","nodeName","userNames","_renderHeader","length","_renderTabs","Tabs"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,EAAqCC,MAArC,EAA6CC,WAA7C,QAAgE,OAAhE;AACA,SACEC,UADF,EAEEC,UAFF,EAGEC,QAHF,EAIEC,OAJF,EAKEC,iBALF,EAMEC,iBANF,EAOEC,cAPF,QAQO,UARP;AASA,OAAO,sBAAP;AACA,OAAO,sBAAP;AACA,OAAO,8BAAP;AAYA,OAAOC,GAAP,MAAgB,QAAhB;AACA,OAAO,eAAP;AAEA,SAASC,kBAAT,EAA6BC,sBAA7B,QAA2D,mBAA3D;AAEA,eAAe,SAASC,UAAT,CAAoBC,KAApB,EAA2B;AAAA,MAEtCC,WAFsC,GAiBpCD,KAjBoC,CAEtCC,WAFsC;AAAA,MAGtCC,UAHsC,GAiBpCF,KAjBoC,CAGtCE,UAHsC;AAAA,MAItCC,aAJsC,GAiBpCH,KAjBoC,CAItCG,aAJsC;AAAA,MAKtCC,UALsC,GAiBpCJ,KAjBoC,CAKtCI,UALsC;AAAA,MAMtCC,YANsC,GAiBpCL,KAjBoC,CAMtCK,YANsC;AAAA,MAOtCC,aAPsC,GAiBpCN,KAjBoC,CAOtCM,aAPsC;AAAA,MAQtCC,WARsC,GAiBpCP,KAjBoC,CAQtCO,WARsC;AAAA,MAStCC,eATsC,GAiBpCR,KAjBoC,CAStCQ,eATsC;AAAA,MAUtCC,iBAVsC,GAiBpCT,KAjBoC,CAUtCS,iBAVsC;AAAA,MAWtCC,IAXsC,GAiBpCV,KAjBoC,CAWtCU,IAXsC;AAAA,MAYtCC,EAZsC,GAiBpCX,KAjBoC,CAYtCW,EAZsC;AAAA,MAatCC,OAbsC,GAiBpCZ,KAjBoC,CAatCY,OAbsC;AAAA,oBAiBpCZ,KAjBoC,CActCa,IAdsC;AAAA,MActCA,IAdsC,4BAc/B,EAd+B;AAAA,wBAiBpCb,KAjBoC,CAetCc,QAfsC;AAAA,MAetCA,QAfsC,gCAe3B,EAf2B;AAAA,MAgBnCC,IAhBmC,iCAiBpCf,KAjBoC;;AAAA,kBAmBJd,QAAQ,CAAC,KAAD,CAnBJ;AAAA,MAmBjC8B,UAnBiC;AAAA,MAmBrBC,aAnBqB;;AAAA,mBAoBV/B,QAAQ,CAAC,KAAD,CApBE;AAAA,MAoBjCgC,OApBiC;AAAA,MAoBxBC,UApBwB;;AAAA,mBAqBJjC,QAAQ,CAAC,EAAD,CArBJ;AAAA,MAqBjCkC,UArBiC;AAAA,MAqBrBC,aArBqB;;AAAA,mBAsBZnC,QAAQ,CAAC,EAAD,CAtBI;AAAA,MAsBjCoC,MAtBiC;AAAA,MAsBzBC,SAtByB;;AAAA,mBAuBdrC,QAAQ,CAAC,EAAD,CAvBM;AAAA,MAuBjCsC,KAvBiC;AAAA,MAuB1BC,QAvB0B;;AAAA,mBAwBVvC,QAAQ,CAAC,KAAD,CAxBE;AAAA,MAwBjCwC,OAxBiC;AAAA,MAwBxBC,UAxBwB;;AAyBxC,MAAMC,EAAE,GAAGzC,MAAM,EAAjB;;AAzBwC,wBA0BT,OAAM0C,QAAN,EA1BS;AAAA,MA0BjCC,KA1BiC;AAAA,MA0B1BC,aA1B0B;;AA4BxC9C,EAAAA,SAAS,CAAC,YAAM;AACd,QAAI0B,EAAE,IAAI,CAACD,IAAX,EAAiB;AACfsB,MAAAA,UAAU,CAACrB,EAAD,CAAV;AACD;;AACD,WAAO,YAAM,CAAE,CAAf;AACD,GALQ,EAKN,CAACA,EAAD,CALM,CAAT;AAOA1B,EAAAA,SAAS,CAAC,YAAM;AACd,QAAIyB,IAAJ,EAAU;AACRW,MAAAA,aAAa,CAACX,IAAD,CAAb;AACD;;AACD,WAAO,YAAM,CAAE,CAAf;AACD,GALQ,EAKN,CAACA,IAAD,CALM,CAAT;;AAnCwC,sBA0CzB,MAAKuB,OAAL,EA1CyB;AAAA,MA0CjCC,IA1CiC;;AA4CxC,MAAMC,UAAU,GAAGhD,MAAM,CAAC;AACxBiD,IAAAA,SAAS,EAAE,mBAACC,UAAD;AAAA,aAAiB;AAC1BC,QAAAA,GAAG,sDAAoDD;AAD7B,OAAjB;AAAA,KADa;AAKxBE,IAAAA,WAAW,EAAE;AAAA,aAAO;AAClBD,QAAAA,GAAG;AADe,OAAP;AAAA;AALW,GAAD,CAAzB;;AAUA,MAAME,KAAK,GAAGrD,MAAM,EAClB;AACEsD,IAAAA,IAAI,EAAE,MADR;AAEEC,IAAAA,GAAG,EAAE,cAFP;AAGEC,IAAAA,MAAM,EAAEvC;AAHV,GADkB,EAMlB;AACEqC,IAAAA,IAAI,EAAE,MADR;AAEEC,IAAAA,GAAG,EAAE,iBAFP;AAGEC,IAAAA,MAAM,EAAE,gBAACC,OAAD,EAAUlC,IAAV;AAAA,0BAAmB,oBAAC,UAAD;AAAY,QAAA,IAAI,EAAEA;AAAlB,QAAnB;AAAA;AAHV,GANkB,EAWlB;AACE+B,IAAAA,IAAI,EAAE,KADR;AAEEC,IAAAA,GAAG,EAAE,aAFP;AAGEC,IAAAA,MAAM,EAAE,gBAACC,OAAD,EAAUlC,IAAV;AAAA,0BAAmB,oBAAC,UAAD;AAAY,QAAA,IAAI,EAAEA;AAAlB,QAAnB;AAAA;AAHV,GAXkB,SAgBfG,IAhBe,EAApB;;AAmBA,MAAMmB,UAAU;AAAA,wEAAG,iBAAOrB,EAAP;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,mBACbC,OADa;AAAA;AAAA;AAAA;;AAAA;AAGbe,cAAAA,UAAU,CAAC,IAAD,CAAV;AAHa,sCAIGQ,UAAU,CAACU,OAAX,CAAmBT,SAAnB,CAA6BzB,EAA7B,CAJH,EAIL2B,GAJK,yBAILA,GAJK;AAAA;AAAA,qBAKG1B,OAAO,CAAC;AAAEkC,gBAAAA,MAAM,EAAE,KAAV;AAAiBR,gBAAAA,GAAG,EAAHA;AAAjB,eAAD,CALV;;AAAA;AAKTS,cAAAA,GALS;AAMTC,cAAAA,CANS,GAMLD,GANK,aAMLA,GANK,oCAMLA,GAAG,CAAErC,IANA,8CAML,UAAWA,IANN;AAObW,cAAAA,aAAa,CAAC2B,CAAD,CAAb;AACAvB,cAAAA,QAAQ,CAAC,CAAAuB,CAAC,SAAD,IAAAA,CAAC,WAAD,+BAAAA,CAAC,CAAEC,YAAH,oEAAiBC,MAAjB,CAAwB,UAACC,IAAD;AAAA,uBAAUA,IAAI,CAACC,WAAf;AAAA,eAAxB,MAAuD,EAAxD,CAAR;AARa;AAAA;;AAAA;AAAA;AAAA;AAUbC,cAAAA,OAAO,CAACC,GAAR;;AAVa;AAAA;AAYb3B,cAAAA,UAAU,CAAC,KAAD,CAAV;AAZa;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAVK,UAAU;AAAA;AAAA;AAAA,KAAhB;;AAiBA,MAAMuB,YAAY,GAAG,SAAfA,YAAe,CAACb,GAAD,EAAS;AAC5BzC,IAAAA,WAAW,IAAIA,WAAW,CAACyC,GAAD,CAA1B;AACD,GAFD;;AAIA,MAAMc,aAAa,GAAG,SAAhBA,aAAgB,GAAM;AAC1B5B,IAAAA,EAAE,CAACiB,OAAH,CAAWY,iBAAX;AACD,GAFD;;AAIA,MAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,GAAM;AAC9BC,IAAAA,QAAQ,CAACC,cAAT;AACD,GAFD;;AAIA,MAAMC,WAAW,GAAG,SAAdA,WAAc,GAAM;AACxB1C,IAAAA,UAAU,CAAC,IAAD,CAAV;AACD,GAFD;;AAIA,MAAM2C,YAAY,GAAG,SAAfA,YAAe;AAAA,WAAO;AAC1BC,MAAAA,KAAK,EAAE,KADmB;AAE1BC,MAAAA,OAAO,EAAE,QAFiB;AAG1BC,MAAAA,MAAM,EAAE,IAHkB;AAI1BC,MAAAA,UAAU,EAAE;AAJc,KAAP;AAAA,GAArB;;AAOA,MAAMC,KAAK;AAAA,yEAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAGWjC,IAAI,CAACkC,cAAL,EAHX;;AAAA;AAGJC,cAAAA,MAHI;AAIVvC,cAAAA,KAAK,CAACwC,OAAN,iCACKR,YAAY,EADjB;AAEEE,gBAAAA,OAAO,EAAE,QAFX;AAGEO,gBAAAA,IAAI,EAAE,gBAAM;AACV,yBAAO,IAAIC,OAAJ;AAAA,yFAAY,kBAAOC,OAAP,EAAgBC,MAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAETC,YAAY,CAAC,OAAD,EAAUN,MAAV,CAFH;;AAAA;AAGf,kCAAI,OAAO9D,WAAP,KAAuB,UAA3B,EAAuCA,WAAW;AAClDkE,8BAAAA,OAAO;AAJQ;AAAA;;AAAA;AAAA;AAAA;AAMfC,8BAAAA,MAAM,cAAN;;AANe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAAZ;;AAAA;AAAA;AAAA;AAAA,sBAAP;AASD;AAbH;AAJU;AAAA;;AAAA;AAAA;AAAA;AAoBVrB,cAAAA,OAAO,CAACC,GAAR;;AApBU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAALa,KAAK;AAAA;AAAA;AAAA,KAAX;;AAwBA,MAAMS,SAAS;AAAA,yEAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAEO1C,IAAI,CAACkC,cAAL,EAFP;;AAAA;AAERC,cAAAA,MAFQ;AAGdvC,cAAAA,KAAK,CAACwC,OAAN,iCACKR,YAAY,EADjB;AAEEE,gBAAAA,OAAO,EAAE,QAFX;AAGEO,gBAAAA,IAAI,EAAE,gBAAM;AACV,yBAAO,IAAIC,OAAJ;AAAA,yFAAY,kBAAOC,OAAP,EAAgBC,MAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qCAETC,YAAY,CAAC,QAAD,EAAWN,MAAX,CAFH;;AAAA;AAGf,kCAAI,OAAO7D,eAAP,KAA2B,UAA/B,EAA2CA,eAAe;AAC1DiE,8BAAAA,OAAO;AAJQ;AAAA;;AAAA;AAAA;AAAA;AAMfC,8BAAAA,MAAM,cAAN;;AANe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAAZ;;AAAA;AAAA;AAAA;AAAA,sBAAP;AASD;AAbH;AAHc;AAAA;;AAAA;AAAA;AAAA;AAmBdrB,cAAAA,OAAO,CAACC,GAAR;;AAnBc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAATsB,SAAS;AAAA;AAAA;AAAA,KAAf;;AAuBA,MAAMD,YAAY;AAAA,yEAAG,kBAAOE,MAAP,EAAeR,MAAf;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sCAEDlC,UAAU,CAACU,OAAX,CAAmBN,WAAnB,EAFC,EAETD,GAFS,yBAETA,GAFS;AAAA;AAAA,qBAGD1B,OAAO,CAAC;AACtBkC,gBAAAA,MAAM,EAAE,MADc;AAEtBR,gBAAAA,GAAG,EAAHA,GAFsB;AAGtB5B,gBAAAA,IAAI;AACFmE,kBAAAA,MAAM,EAANA;AADE,mBAECR,MAFD;AAHkB,eAAD,CAHN;;AAAA;AAGbtB,cAAAA,GAHa;AAWb+B,cAAAA,GAXa,GAWP/B,GAXO,aAWPA,GAXO,qCAWPA,GAAG,CAAErC,IAXE,+CAWP,WAAWA,IAXJ;;AAYjB,uBAAQqE,OAAR,CAAgBD,GAAhB;;AACA5C,cAAAA,IAAI,CAAC8C,WAAL;AACAzD,cAAAA,SAAS,CAAC,EAAD,CAAT;;AACAS,cAAAA,UAAU,CAACrB,EAAD,CAAV;;AAfiB,gDAgBV6D,OAAO,CAACC,OAAR,EAhBU;;AAAA;AAAA;AAAA;AAAA,gDAkBVD,OAAO,CAACE,MAAR,cAlBU;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAZC,YAAY;AAAA;AAAA;AAAA,KAAlB;;AAsBA,MAAMM,aAAa,GAAG,SAAhBA,aAAgB,GAAM;AAC1BjD,IAAAA,UAAU,CAACrB,EAAD,CAAV;;AACAQ,IAAAA,UAAU,CAAC,KAAD,CAAV;AACAe,IAAAA,IAAI,CAACgD,cAAL,CAAoB;AAAEC,MAAAA,aAAa,EAAE;AAAjB,KAApB;AACA,QAAI,OAAO1E,iBAAP,KAA6B,UAAjC,EAA6CA,iBAAiB;AAC/D,GALD;;AAOA,MAAM2E,iBAAiB,GAAG,SAApBA,iBAAoB,GAAM;AAC9BjE,IAAAA,UAAU,CAAC,KAAD,CAAV;AACD,GAFD;;AAIA,MAAMkE,eAAe,GAAG,SAAlBA,eAAkB,CAACC,aAAD,EAAgBC,SAAhB,EAA8B;AACpDhE,IAAAA,SAAS,CAAC+D,aAAa,CAACH,aAAf,CAAT;AACD,GAFD;;AAIA,MAAMK,kBAAkB,GAAG,SAArBA,kBAAqB,CAACF,aAAD,EAAmB;AAC5CpD,IAAAA,IAAI,CAACgD,cAAL,CAAoB;AAAEC,MAAAA,aAAa,EAAEG,aAAa,CAACG;AAA/B,KAApB;AACD,GAFD;;AAIA,MAAMC,cAAc,GAAG,SAAjBA,cAAiB,GAAM;AAC3B,QAAI,OAAOvF,aAAP,KAAyB,UAA7B,EAAyC,OAAOA,aAAa,EAApB;AACzC,wBACE;AAAK,MAAA,SAAS,EAAC;AAAf,oBACE,oCACM;AACFwF,MAAAA,QAAQ,EAAE;AAAEC,QAAAA,IAAI,EAAE;AAAR,OADR;AAEFC,MAAAA,UAAU,EAAE;AAAED,QAAAA,IAAI,EAAE;AAAR;AAFV,KADN;AAKE,MAAA,IAAI,EAAE1D,IALR;AAME,MAAA,KAAK,EAAE;AAAE4D,QAAAA,KAAK,EAAE;AAAT,OANT;AAOE,MAAA,IAAI,EAAC,qBAPP;AAQE,MAAA,cAAc,EAAET;AARlB,qBAUE,0BAAM,IAAN;AACE,MAAA,KAAK,EAAC,0BADR;AAEE,MAAA,IAAI,EAAC,QAFP;AAGE,MAAA,KAAK,EAAE,CAAC;AAAEU,QAAAA,QAAQ,EAAE,IAAZ;AAAkBC,QAAAA,OAAO,EAAE;AAA3B,OAAD;AAHT,oBAKE;AACE;AACA,MAAA,WAAW,EAAC,sCAFd,CAGE;;AAHF,OAKGxE,KALH,aAKGA,KALH,uBAKGA,KAAK,CAAEyE,GAAP,CAAW,UAACjD,CAAD,EAAIkD,CAAJ;AAAA,0BACV,4BAAQ,MAAR;AAAe,QAAA,GAAG,EAAEA,CAApB;AAAuB,QAAA,KAAK,EAAElD,CAAC,CAACmD;AAAhC,SACMnD,CAAC,CAACoD,QADR,WACsBpD,CAAC,CAACqD,SADxB,CADU;AAAA,KAAX,CALH,CALF,CAVF,eA2BE,0BAAM,IAAN;AACE,MAAA,KAAK,EAAC,gCADR;AAEE,MAAA,IAAI,EAAC,eAFP;AAGE,MAAA,KAAK,EAAE,CAAC;AAAEN,QAAAA,QAAQ,EAAE,IAAZ;AAAkBC,QAAAA,OAAO,EAAE;AAA3B,OAAD;AAHT,oBAKE,2BAAO,QAAP;AAAgB,MAAA,WAAW,EAAC;AAA5B,MALF,CA3BF,CADF,CADF;AAuCD,GAzCD;;AA2CA,MAAMM,aAAa,GAAG,SAAhBA,aAAgB,GAAM;AAC1B,QAAI,OAAOjG,YAAP,KAAwB,UAA5B,EAAwC,OAAOA,YAAY,CAACL,KAAD,CAAnB;AACxC,wBACE;AAAK,MAAA,SAAS,EAAC;AAAf,oBACE;AAAK,MAAA,SAAS,EAAC;AAAf,oBACE;AAAK,MAAA,SAAS,EAAC;AAAf,OACGoB,UAAU,IAAIA,UAAU,CAAC2C,KAD5B,CADF,eAIE,oBAAC,cAAD;AAAgB,MAAA,EAAE,EAAEnC;AAApB,MAJF,CADF,eAOE;AAAK,MAAA,SAAS,EAAC;AAAf,OAA+B8D,cAAc,EAA7C,CAPF,eASE,oBAAC,iBAAD;AACE,MAAA,IAAI,EAAEtE,UADR;AAEE,MAAA,UAAU,EAAEyC,WAFd;AAGE,MAAA,OAAO,EAAEM,KAHX;AAIE,MAAA,QAAQ,EAAES,SAJZ;AAKE,MAAA,UAAU,EAAEpD,KAAK,CAAC+E;AALpB,OAMMxF,IANN,EATF,CADF;AAoBD,GAtBD;;AAwBA,MAAMyF,WAAW,GAAG,SAAdA,WAAc,GAAM;AAAA;;AACxB,QAAI,OAAOtG,UAAP,KAAsB,UAA1B,EAAsC,OAAOA,UAAU,CAACF,KAAD,CAAjB;AACtC,QAAMyG,IAAI,GAAGnG,aAAa,IAAIf,QAA9B;AACA,wBACE,oBAAC,IAAD;AACE,MAAA,gBAAgB,EAAEiD,KAAF,aAAEA,KAAF,yCAAEA,KAAK,CAAEK,OAAP,CAAe,CAAf,CAAF,mDAAE,eAAmBH,GADvC;AAEE,MAAA,QAAQ,EAAEa;AAFZ,OAGMzC,QAHN,oBAKG0B,KAAK,CAACK,OALT,0EAKG,cACGK,MADH,CACU,UAACF,CAAD;AAAA,aAAOA,CAAC,CAACL,MAAT;AAAA,KADV,CALH,yDAKG,qBAEGsD,GAFH,CAEO,UAACjD,CAAD;AAAA,0BACJ,oBAAC,OAAD;AAAS,QAAA,GAAG,EAAEA,CAAC,CAACP,IAAhB;AAAsB,QAAA,GAAG,EAAEO,CAAC,CAACN;AAA7B,SACGM,CAAC,CAACL,MAAF,IAAYK,CAAC,CAACL,MAAF,CAASK,CAAT,EAAY5B,UAAZ,CADf,CADI;AAAA,KAFP,CALH,CADF;AAeD,GAlBD;;AAoBA,sBACE;AAAK,IAAA,SAAS,EAAC,aAAf;AAA6B,IAAA,GAAG,EAAEQ;AAAlC,kBACE;AAAM,IAAA,QAAQ,EAAEF;AAAhB,KAEG4E,aAAa,EAFhB,EAGGE,WAAW,EAHd,eAIE,oBAAC,iBAAD;AACE,IAAA,OAAO,EAAEtF,OADX;AAEE,IAAA,MAAM,EAAEI,MAFV;AAGE,IAAA,SAAS,EAAEC,SAHb;AAIE,IAAA,YAAY,EAAE,CAAAH,UAAU,SAAV,IAAAA,UAAU,WAAV,YAAAA,UAAU,CAAE6B,YAAZ,KAA4B,EAJ5C;AAKE,IAAA,IAAI,EAAEgC,aALR;AAME,IAAA,OAAO,EAAErE,OANX;AAOE,IAAA,QAAQ,EAAEwE,iBAPZ;AAQE,IAAA,iBAAiB,EAAEI;AARrB,IAJF,EAcGzD,aAdH,CADF,CADF;AAoBD","sourcesContent":["import React, { useEffect, useState, useRef, useCallback } from \"react\";\r\nimport {\r\n  FlowViewer,\r\n  FlowRecord,\r\n  FlowTabs,\r\n  TabPane,\r\n  FlowActionButtons,\r\n  FlowTransferModal,\r\n  FlowFullScreen,\r\n} from \"../index\";\r\nimport \"../flow-viewer/style\";\r\nimport \"../flow-record/style\";\r\nimport \"../flow-action-buttons/style\";\r\nimport {\r\n  Button,\r\n  Row,\r\n  Col,\r\n  Input,\r\n  Modal,\r\n  Select,\r\n  Form,\r\n  message,\r\n  Spin,\r\n} from \"antd\";\r\nimport api from \"../api\";\r\nimport \"./style/index\";\r\n\r\nimport { FullscreenOutlined, FullscreenExitOutlined } from \"@ant-design/icons\";\r\n\r\nexport default function FlowDetail(props) {\r\n  const {\r\n    onTabChange,\r\n    renderTabs,\r\n    renderApprove,\r\n    renderInfo,\r\n    renderHeader,\r\n    TabsComponent,\r\n    onOkSuccess,\r\n    onRejectSuccess,\r\n    onTransferSuccess,\r\n    data,\r\n    id,\r\n    request,\r\n    tabs = [],\r\n    tabProps = {},\r\n    ...rest\r\n  } = props;\r\n\r\n  const [fullScreen, setFullScreen] = useState(false);\r\n  const [visible, setVisible] = useState(false);\r\n  const [detailData, setDetailData] = useState({});\r\n  const [remark, setRemark] = useState(\"\");\r\n  const [tasks, setTasks] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const el = useRef();\r\n  const [modal, contextHolder] = Modal.useModal();\r\n\r\n  useEffect(() => {\r\n    if (id && !data) {\r\n      _fetchData(id);\r\n    }\r\n    return () => {};\r\n  }, [id]);\r\n\r\n  useEffect(() => {\r\n    if (data) {\r\n      setDetailData(data);\r\n    }\r\n    return () => {};\r\n  }, [data]);\r\n\r\n  const [form] = Form.useForm();\r\n\r\n  const _detailApi = useRef({\r\n    getDetail: (procInstId) => ({\r\n      url: `/caas/osoBpmProcInst/getFlowDetailByProcInstId/${procInstId}`,\r\n    }),\r\n\r\n    postApprove: () => ({\r\n      url: `/caas/osoBpmTask/approve`,\r\n    }),\r\n  });\r\n\r\n  const _tabs = useRef([\r\n    {\r\n      name: \"审批信息\",\r\n      key: \"approve_form\",\r\n      render: renderInfo,\r\n    },\r\n    {\r\n      name: \"审批日志\",\r\n      key: \"approve_records\",\r\n      render: (tabItem, data) => <FlowRecord data={data} />,\r\n    },\r\n    {\r\n      name: \"流程图\",\r\n      key: \"task_viewer\",\r\n      render: (tabItem, data) => <FlowViewer data={data} />,\r\n    },\r\n    ...tabs,\r\n  ]);\r\n\r\n  const _fetchData = async (id) => {\r\n    if (request) {\r\n      try {\r\n        setLoading(true);\r\n        const { url } = _detailApi.current.getDetail(id);\r\n        let res = await request({ method: \"GET\", url });\r\n        let d = res?.data?.data;\r\n        setDetailData(d);\r\n        setTasks(d?.runTimeTasks?.filter((item) => item.approveFlag) || []);\r\n      } catch (e) {\r\n        console.log(e);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  const _onTabChange = (key) => {\r\n    onTabChange && onTabChange(key);\r\n  };\r\n\r\n  const _onFullScreen = () => {\r\n    el.current.requestFullscreen();\r\n  };\r\n\r\n  const _onExitFullScreen = () => {\r\n    document.exitFullscreen();\r\n  };\r\n\r\n  const _onTransfer = () => {\r\n    setVisible(true);\r\n  };\r\n\r\n  const _modalConfig = () => ({\r\n    title: \"确认!\",\r\n    content: \"同意该流程?\",\r\n    okText: \"确定\",\r\n    cancelText: \"取消\",\r\n  });\r\n\r\n  const _onOk = async () => {\r\n    // console.log(\"onOk\");\r\n    try {\r\n      const values = await form.validateFields();\r\n      modal.confirm({\r\n        ..._modalConfig(),\r\n        content: \"同意该流程?\",\r\n        onOk: () => {\r\n          return new Promise(async (resolve, reject) => {\r\n            try {\r\n              await _postApprove(\"AGREE\", values);\r\n              if (typeof onOkSuccess === \"function\") onOkSuccess();\r\n              resolve()\r\n            } catch (e) {\r\n              reject(e);\r\n            }\r\n          });\r\n        },\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n    }\r\n  };\r\n\r\n  const _onReject = async () => {\r\n    try {\r\n      const values = await form.validateFields();\r\n      modal.confirm({\r\n        ..._modalConfig(),\r\n        content: \"驳回该流程?\",\r\n        onOk: () => {\r\n          return new Promise(async (resolve, reject) => {\r\n            try {\r\n              await _postApprove(\"REJECT\", values);\r\n              if (typeof onRejectSuccess === \"function\") onRejectSuccess();\r\n              resolve();\r\n            } catch (e) {\r\n              reject(e);\r\n            }\r\n          });\r\n        },\r\n      });\r\n    } catch (e) {\r\n      console.log(e);\r\n    }\r\n  };\r\n\r\n  const _postApprove = async (status, values) => {\r\n    try {\r\n      const { url } = _detailApi.current.postApprove();\r\n      let res = await request({\r\n        method: \"POST\",\r\n        url,\r\n        data: {\r\n          status,\r\n          ...values,\r\n        },\r\n      });\r\n      let msg = res?.data?.data;\r\n      message.success(msg);\r\n      form.resetFields();\r\n      setRemark(\"\");\r\n      _fetchData(id);\r\n      return Promise.resolve()\r\n    } catch (e) {\r\n      return Promise.reject(e);\r\n    }\r\n  };\r\n\r\n  const _onTransferOk = () => {\r\n    _fetchData(id);\r\n    setVisible(false);\r\n    form.setFieldsValue({ approveRemark: \"\" });\r\n    if (typeof onTransferSuccess === \"function\") onTransferSuccess();\r\n  };\r\n\r\n  const _onTransferCancel = () => {\r\n    setVisible(false);\r\n  };\r\n\r\n  const _onRemarkChange = (changedValues, allValues) => {\r\n    setRemark(changedValues.approveRemark);\r\n  };\r\n\r\n  const _onModelFormChange = (changedValues) => {\r\n    form.setFieldsValue({ approveRemark: changedValues.reason });\r\n  };\r\n\r\n  const _renderApprove = () => {\r\n    if (typeof renderApprove === \"function\") return renderApprove();\r\n    return (\r\n      <div className=\"flow-approve-detault\">\r\n        <Form\r\n          {...{\r\n            labelCol: { span: 2 },\r\n            wrapperCol: { span: 22 },\r\n          }}\r\n          form={form}\r\n          style={{ width: \"100%\" }}\r\n          name=\"flow-detail-default\"\r\n          onValuesChange={_onRemarkChange}\r\n        >\r\n          <Form.Item\r\n            label=\"流程节点\"\r\n            name=\"taskId\"\r\n            rules={[{ required: true, message: \"请选择流程节点\" }]}\r\n          >\r\n            <Select\r\n              // mode=\"multiple\"\r\n              placeholder=\"选择流程节点\"\r\n              // onChange={onChange}\r\n            >\r\n              {tasks?.map((d, i) => (\r\n                <Select.Option key={i} value={d.taskId}>\r\n                  {`${d.nodeName} - ${d.userNames}`}\r\n                </Select.Option>\r\n              ))}\r\n            </Select>\r\n          </Form.Item>\r\n          <Form.Item\r\n            label=\"备注说明：\"\r\n            name=\"approveRemark\"\r\n            rules={[{ required: true, message: \"请输入备注说明!\" }]}\r\n          >\r\n            <Input.TextArea placeholder=\"请输入备注说明\" />\r\n          </Form.Item>\r\n        </Form>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const _renderHeader = () => {\r\n    if (typeof renderHeader === \"function\") return renderHeader(props);\r\n    return (\r\n      <div className=\"flow-detail-header\">\r\n        <div className=\"flow-detail-top\">\r\n          <div className=\"flow-detail-title\">\r\n            {detailData && detailData.title}\r\n          </div>\r\n          <FlowFullScreen el={el} />\r\n        </div>\r\n        <div className=\"flow-approve\">{_renderApprove()}</div>\r\n\r\n        <FlowActionButtons\r\n          data={detailData}\r\n          onTransfer={_onTransfer}\r\n          onAgree={_onOk}\r\n          onReject={_onReject}\r\n          canApprove={tasks.length}\r\n          {...rest}\r\n        />\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const _renderTabs = () => {\r\n    if (typeof renderTabs === \"function\") return renderTabs(props);\r\n    const Tabs = TabsComponent || FlowTabs;\r\n    return (\r\n      <Tabs\r\n        defaultActiveKey={_tabs?.current[0]?.key}\r\n        onChange={_onTabChange}\r\n        {...tabProps}\r\n      >\r\n        {_tabs.current\r\n          ?.filter((d) => d.render)\r\n          ?.map((d) => (\r\n            <TabPane tab={d.name} key={d.key}>\r\n              {d.render && d.render(d, detailData)}\r\n            </TabPane>\r\n          ))}\r\n      </Tabs>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"flow-detail\" ref={el}>\r\n      <Spin spinning={loading}>\r\n        {/* {detailData.approveFlag === false ? null : _renderHeader()} */}\r\n        {_renderHeader()}\r\n        {_renderTabs()}\r\n        <FlowTransferModal\r\n          visible={visible}\r\n          remark={remark}\r\n          setRemark={setRemark}\r\n          runTimeTasks={detailData?.runTimeTasks || []}\r\n          onOk={_onTransferOk}\r\n          request={request}\r\n          onCancel={_onTransferCancel}\r\n          onModelFormChange={_onModelFormChange}\r\n        />\r\n        {contextHolder}\r\n      </Spin>\r\n    </div>\r\n  );\r\n}\r\n"],"file":"index.js"}